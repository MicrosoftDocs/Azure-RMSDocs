---
title: Concepts - Auditing in the Microsoft Information Protection SDK File API
description: This article will help you understand how to use the Microsoft Information Protection SDK to submit File API auditing events to Azure Information Protection Analytics.
services: information-protection
author: tommoser
ms.service: information-protection
ms.topic: conceptual
ms.date: 11/01/2018
ms.author: tommos
---

# Auditing in the MIP SDK File API

The Azure Information Protection administration portal provides access to administrator reports. These reports provide visibility in to which labels users are applying, manually or automatically, across any applications any services that have integrated the MIP SDK. Development partners using the SDK can easily enable this functionality so that information from their applications will surface in customer reports.

## Event Types

There are three types of events that can be submitted via the SDK to Azure Information Protection Analytics. **Heartbeat events**, **discovery events**, and **change events**

### Heartbeat Events

Heartbeat events are generated automatically for any application that has integrated the File API. Heartbeat events include:

* TenantId
* Time Generated
* User Principal Name
* Name of the machine where the audit was generated
* Process Name
* Platform
* Application ID - Corresponds to the Azure AD Application ID.

These events are useful in detecting applications across your enterprise that are using the Microsoft Information Protection SDK.

### Discovery Events

Discovery events provide information on labeled information that is read or consumed by the File API. These events are useful as they surface the devices, location, and users who are accessing information across an organization.

These events are submitted to Azure Information Protection Analytics, by setting the `AuditDiscoveryEnabled` parameter to true when creating a new `mip::FileHandler`. Additionally, a content identifier that identifies the file in some human-readable format is provided. It's recommended to use the file path for this identifier.

The example below creates a new `mip::FileHandler` with audit discovery enabled. The `CreateFileHandler()` method is called on the `mip::FileEngine` and `AuditDiscoveryEnabled` set to true. Once the `FileHanlder` reads the label, a discovery audit is generated.

```cpp
// Create FileHandler with discovery enabled
auto handlerPromise = std::make_shared<std::promise<std::shared_ptr<FileHandler>>>();
auto handlerFuture = handlerPromise->get_future();
fileEngine->CreateFileHandlerAsync(filePath, contentId, mip::ContentState::REST, true /*AuditDiscoveryEnabled*/, make_shared<FileHandlerObserver>(), createFileHandlerPromise);
auto handler = handlerFuture.get();

// Read label. This generates the discovery audit.
auto label = handler->GetLabel();
```

### Change Events

Change events provide information about the file, the label that was applied or changed, and any justifications provided by the user. Change events are generated by calling `NotifyCommitSuccessful()` on the `mip::FileHandler`, after a change has been successfully committed to a file.

```cpp
// Create labeling options, set label
string contentId = "C:\users\myuser\Documents\MyPlan.docx";
mip::LabelingOptions labelingOptions(mip::AssignmentMethod::PRIVILEGED, mip::ActionSource::MANUAL);
handler->SetLabel(labelId, labelingOptions);
auto commitPromise = std::make_shared<std::promise<bool>>();
auto commitFuture = commitPromise->get_future();

// CommitAsync() returns a bool. If the change was successful, call NotifyCommitSuccessful().
fileHandler->CommitAsync(outputFile, commitPromise);
if(commitFuture.get()) {

    // Submit audit event.
    handler->NotifyCommitSuccessful(contentId);
}
```

## Audit Dashboard

Events submitted to the Azure Information Protection audit pipeline will surface in reports at https://portal.azure.com. Azure Information Protection Analytics is in public preview and features/functionality are subject to change.

## Next Steps

For more details on the auditing experience in Azure Information Protection, take a look at the [preview announcement blog on Tech Community](https://techcommunity.microsoft.com/t5/Azure-Information-Protection/Data-discovery-reporting-and-analytics-for-all-your-data-with/ba-p/253854).
